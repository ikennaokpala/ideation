{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://sparc-dsl.dev/schemas/simulation-kpi-definitions-v1.schema.json",
  "title": "Simulation KPI definitions (v1)",
  "description": "Contract for defining stable KPI definitions independent of fidelity profile (Sprint 2).",
  "type": "object",
  "additionalProperties": true,
  "required": ["$schema", "schema", "version", "kpis"],
  "properties": {
    "$schema": { "type": "string" },
    "schema": { "const": "simulation_kpi_definitions_v1" },
    "version": { "type": "string", "pattern": "^\\d+\\.\\d+(\\.\\d+)?$" },
    "description": { "type": "string" },
    "kpis": { "type": "array", "items": { "$ref": "#/definitions/kpi_def" }, "minItems": 1 }
  },
  "definitions": {
    "kpi_def": {
      "type": "object",
      "additionalProperties": true,
      "required": ["kpi_id", "name", "definition"],
      "properties": {
        "kpi_id": { "type": "string", "minLength": 1 },
        "name": { "type": "string", "minLength": 1 },
        "definition": { "type": "string" },
        "description": { "type": "string" },
        "unit": { "type": "string" },
        "direction": {
          "enum": ["higher_is_better", "lower_is_better", "neutral"]
        },
        "stable_across_profiles": { "type": "boolean" },
        "inputs": { "type": "array", "items": { "$ref": "#/definitions/kpi_input" } },
        "formula": { "type": "string" },
        "sql": { "type": "string" },
        "tags": { "type": "array", "items": { "type": "string" } }
      }
    },
    "kpi_input": {
      "type": "object",
      "additionalProperties": true,
      "required": ["event_type"],
      "properties": {
        "event_type": { "type": "string", "minLength": 1 },
        "where": { "type": "string" },
        "fields": { "type": "array", "items": { "type": "string" } }
      }
    }
  }
}

