{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://sparc-dsl.dev/schemas/logic.yaml.json",
  "title": "SPARC Logic DSL Schema",
  "description": "Schema for `dsl/logic.yaml` files (validations, workflows, state machines, rules).",
  "type": "object",
  "additionalProperties": true,
  "required": ["$schema", "version", "meta"],
  "properties": {
    "$schema": { "type": "string" },
    "version": { "type": "string", "pattern": "^\\d+\\.\\d+(\\.\\d+)?$" },
    "meta": { "$ref": "#/definitions/meta" },
    "validations": { "type": "array", "items": { "$ref": "#/definitions/validation_def" } },
    "state_machines": { "type": "array", "items": { "$ref": "#/definitions/state_machine_def" } },
    "workflows": { "type": "array" },
    "rules": { "type": "array" },
    "scheduled_tasks": { "type": "array" },
    "events": { "type": "array" },
    "simulation": { "type": "object" }
  },
  "definitions": {
    "meta": {
      "type": "object",
      "additionalProperties": true,
      "required": ["name", "version"],
      "properties": {
        "name": { "type": "string" },
        "description": { "type": "string" },
        "version": { "type": "string" },
        "targets": { "type": "object" }
      }
    },
    "validation_def": {
      "type": "object",
      "additionalProperties": true,
      "required": ["name", "schema"],
      "properties": {
        "name": { "type": "string", "minLength": 1 },
        "description": { "type": "string" },
        "schema": { "type": "object" },
        "targets": { "type": "array", "items": { "type": "string" } }
      }
    },
    "context_var": {
      "type": "object",
      "additionalProperties": true,
      "required": ["name", "type"],
      "properties": {
        "name": { "type": "string", "minLength": 1 },
        "type": { "type": "string" },
        "default": {}
      }
    },
    "state_def": {
      "type": "object",
      "additionalProperties": true,
      "required": ["name"],
      "properties": {
        "name": { "type": "string", "minLength": 1 },
        "description": { "type": "string" },
        "on_entry": { "type": "array" },
        "on_exit": { "type": "array" }
      }
    },
    "state_machine_def": {
      "type": "object",
      "additionalProperties": true,
      "required": ["name", "initial", "states"],
      "properties": {
        "name": { "type": "string", "minLength": 1 },
        "description": { "type": "string" },
        "entity_ref": { "type": "string" },
        "initial": { "type": "string", "minLength": 1 },
        "context": { "type": "array", "items": { "$ref": "#/definitions/context_var" } },
        "states": { "type": "array", "items": { "$ref": "#/definitions/state_def" }, "minItems": 1 },
        "transitions": { "type": "array" }
      }
    }
  }
}

