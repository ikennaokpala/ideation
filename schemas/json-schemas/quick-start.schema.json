{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://sparc-dsl.dev/schemas/quick-start.schema.json",
  "title": "SPARC Quick Start Template Schema",
  "description": "Schema for SPARC quick start templates used by `sparc init --template ...`.",
  "type": "object",
  "additionalProperties": true,
  "required": ["$schema", "template", "version", "level", "meta", "entities"],
  "properties": {
    "$schema": { "type": "string" },
    "template": { "type": "string", "minLength": 1 },
    "version": { "type": "string", "pattern": "^\\d+\\.\\d+(\\.\\d+)?$" },
    "level": { "type": "integer", "minimum": 0, "maximum": 3 },
    "extends": { "type": "string" },
    "meta": { "$ref": "#/definitions/meta" },
    "multi_tenancy": { "$ref": "#/definitions/multi_tenancy" },
    "entities": { "type": "array", "items": { "$ref": "#/definitions/entity" } },
    "auth": { "type": "object" },
    "billing": { "type": "object" },
    "rbac": { "type": "object" },
    "api": { "type": "object" },
    "tests": { "type": "array", "items": { "$ref": "#/definitions/test_case" } },
    "prompts": { "type": "array", "items": { "$ref": "#/definitions/prompt" } },
    "generates": { "type": "array", "items": { "$ref": "#/definitions/generate_rule" } },
    "env_vars": { "$ref": "#/definitions/env_vars" },
    "upgrade_to_level_1": { "type": "object" }
  },
  "definitions": {
    "meta": {
      "type": "object",
      "additionalProperties": true,
      "required": ["name", "version"],
      "properties": {
        "name": { "type": "string" },
        "description": { "type": "string" },
        "version": { "type": "string" }
      }
    },
    "multi_tenancy": {
      "type": "object",
      "additionalProperties": true,
      "properties": {
        "enabled": { "type": "boolean" },
        "strategy": { "type": "string" },
        "tenant_column": { "type": "string" }
      }
    },
    "entity": {
      "type": "object",
      "additionalProperties": true,
      "required": ["name", "table", "columns"],
      "properties": {
        "name": { "type": "string", "minLength": 1 },
        "table": { "type": "string", "minLength": 1 },
        "columns": { "type": "array", "items": { "$ref": "#/definitions/column" } },
        "indexes": { "type": "array", "items": { "$ref": "#/definitions/index" } },
        "row_level_security": { "type": "object" }
      }
    },
    "column": {
      "type": "object",
      "additionalProperties": true,
      "required": ["name", "type"],
      "properties": {
        "name": { "type": "string", "minLength": 1 },
        "type": { "type": "string", "minLength": 1 },
        "primary": { "type": "boolean" },
        "required": { "type": "boolean" },
        "unique": { "type": "boolean" },
        "default": {},
        "check": { "type": "string" },
        "comment": { "type": "string" },
        "references": { "type": "string" },
        "on_delete": { "type": "string" }
      }
    },
    "index": {
      "type": "object",
      "additionalProperties": true,
      "required": ["columns"],
      "properties": {
        "columns": { "type": "array", "items": { "type": "string" }, "minItems": 1 },
        "unique": { "type": "boolean" }
      }
    },
    "test_case": {
      "type": "object",
      "additionalProperties": true,
      "required": ["name", "request", "expect"],
      "properties": {
        "name": { "type": "string" },
        "path_ref": { "type": "string" },
        "setup": { "type": "array" },
        "mocks": { "type": "object" },
        "request": { "type": "object" },
        "expect": { "type": "object" }
      }
    },
    "prompt": {
      "type": "object",
      "additionalProperties": true,
      "required": ["name", "message"],
      "properties": {
        "name": { "type": "string", "minLength": 1 },
        "message": { "type": "string" },
        "type": { "type": "string" },
        "default": {}
      }
    },
    "generate_rule": {
      "type": "object",
      "additionalProperties": false,
      "required": ["path", "from"],
      "properties": {
        "path": { "type": "string", "minLength": 1 },
        "from": { "type": "string", "minLength": 1 }
      }
    },
    "env_var": {
      "type": "object",
      "additionalProperties": false,
      "required": ["name", "description"],
      "properties": {
        "name": { "type": "string", "minLength": 1 },
        "description": { "type": "string" }
      }
    },
    "env_vars": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "required": { "type": "array", "items": { "$ref": "#/definitions/env_var" } },
        "optional": { "type": "array", "items": { "$ref": "#/definitions/env_var" } }
      }
    }
  }
}

