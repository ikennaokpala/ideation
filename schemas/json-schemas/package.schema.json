{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://sparc-dsl.dev/schemas/package.schema.json",
  "title": "SPARC Package Schema",
  "description": "JSON Schema for SPARC v6.1 package.yaml validation",
  "type": "object",
  "required": ["meta", "architecture", "contents"],
  "properties": {
    "$schema": {
      "type": "string",
      "description": "Reference to this JSON Schema"
    },
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+(\\.\\d+)?$",
      "description": "SPARC version (e.g., 6.1 or 6.1.1)"
    },
    "meta": {
      "$ref": "#/definitions/meta"
    },
    "complexity": {
      "$ref": "#/definitions/complexity"
    },
    "lite_mode": {
      "$ref": "#/definitions/lite_mode"
    },
    "architecture": {
      "$ref": "#/definitions/architecture"
    },
    "contents": {
      "$ref": "#/definitions/contents"
    },
    "testing_rules": {
      "$ref": "#/definitions/testing_rules"
    },
    "cross_references": {
      "type": "object"
    },
    "interpreters": {
      "type": "object"
    },
    "simulation": {
      "type": "object"
    },
    "structure": {
      "type": "object"
    },
    "validation": {
      "type": "object"
    }
  },
  "definitions": {
    "meta": {
      "type": "object",
      "required": ["name"],
      "properties": {
        "name": {
          "type": "string",
          "minLength": 1,
          "description": "Project name"
        },
        "description": {
          "type": "string"
        },
        "version": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+\\.\\d+$"
        },
        "generated_at": {
          "type": "string",
          "format": "date-time"
        },
        "generator": {
          "type": "string"
        },
        "idea": {
          "type": "object",
          "properties": {
            "name": { "type": "string" },
            "tagline": { "type": "string" },
            "problem_statement": { "type": "string" },
            "target_users": {
              "type": "array",
              "items": { "type": "string" }
            },
            "primary_kpi": { "type": "string" }
          }
        }
      }
    },
    "complexity": {
      "type": "object",
      "properties": {
        "mode": {
          "type": "string",
          "enum": ["lite", "standard", "enterprise", ""]
        },
        "auto_detected": {
          "type": "boolean"
        },
        "lite_indicators": {
          "type": "array",
          "items": { "type": "string" }
        },
        "standard_indicators": {
          "type": "array",
          "items": { "type": "string" }
        },
        "enterprise_indicators": {
          "type": "array",
          "items": { "type": "string" }
        },
        "override": {
          "type": "object",
          "properties": {
            "enabled": { "type": "boolean" },
            "reason": { "type": "string" }
          }
        }
      }
    },
    "lite_mode": {
      "type": "object",
      "properties": {
        "description": { "type": "string" },
        "enabled": { "type": "boolean" },
        "skipped_phases": {
          "type": "array",
          "items": { "type": "string" }
        },
        "simplified_files": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": { "type": "string" },
              "description": { "type": "string" },
              "replaces": {
                "type": "array",
                "items": { "type": "string" }
              }
            }
          }
        },
        "structure": {
          "type": "object"
        },
        "validation": {
          "type": "array",
          "items": { "type": "string" }
        },
        "example": { "type": "string" }
      }
    },
    "architecture": {
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "enum": ["platform", "single_saas", ""]
        },
        "confidence": {
          "type": "string",
          "enum": ["high", "medium", "low", ""]
        },
        "rationale": {
          "type": "string"
        },
        "platform_config": {
          "type": "object",
          "properties": {
            "bounded_contexts": {
              "type": "array",
              "items": { "type": "string" }
            },
            "shared_services": {
              "type": "array",
              "items": { "type": "string" }
            },
            "unified_auth": { "type": "boolean" },
            "repository_per_context": { "type": "boolean" }
          }
        },
        "white_label": {
          "type": "object",
          "properties": {
            "enabled": { "type": "boolean" },
            "standalone_deployable": { "type": "boolean" },
            "customization_layers": {
              "type": "array",
              "items": { "type": "string" }
            }
          }
        }
      }
    },
    "contents": {
      "type": "object",
      "properties": {
        "architecture": { "type": "object" },
        "business": { "type": "object" },
        "software": { "type": "object" },
        "dsl": { "type": "object" },
        "tests": { "type": "object" },
        "simulation": { "type": "object" }
      }
    },
    "testing_rules": {
      "type": "object",
      "properties": {
        "level": {
          "type": "object",
          "properties": {
            "type": {
              "type": "string",
              "enum": ["api_integration_only", "unit_and_integration"]
            },
            "description": { "type": "string" }
          }
        },
        "coverage": {
          "type": "object",
          "properties": {
            "type": { "type": "string" },
            "description": { "type": "string" },
            "lite_override": { "type": "string" }
          }
        },
        "mocking": {
          "type": "object",
          "properties": {
            "allowed": {
              "type": "array",
              "items": { "type": "string" }
            },
            "forbidden": {
              "type": "array",
              "items": { "type": "string" }
            }
          }
        },
        "data": {
          "type": "object",
          "properties": {
            "strategy": { "type": "string" },
            "fallback": { "type": "string" },
            "description": { "type": "string" }
          }
        },
        "database": {
          "type": "object",
          "properties": {
            "type": { "type": "string" },
            "isolation": { "type": "string" },
            "description": { "type": "string" }
          }
        }
      }
    }
  }
}
